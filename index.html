<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width height=device-height" />
    <meta name="description" content="rlottie viewer" />
    <meta
      name="keywords"
      content="lottie, rlottie, lottie viewer, rlottie viewer"
    />
    <meta name="author" content="Subhransu" />
    <title>rlottie viewer</title>
    <link rel="stylesheet" href="style.css" />
    <script type="text/javascript" src="dragresize.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
      rel="stylesheet"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
  </head>

  <body>
    <div id="app">
      <v-app>
        <v-main class="main-window">
          <upper-bar :left="initCanvasLeft"></upper-bar>
          <left-bar
            @child-event="setHeight"
            :selectedmenu="selectedMenu"
            @menuclicked="ChangeMenu"
          ></left-bar>
          <left-bar-detail
            class="setScroll"
            :canvas-size="canvasSize"
            :selectedmenu="selectedMenu"
            v-if="activeDetailBar"
            @close-sidebar="CloseMenuBar"
            :height="leftHeight"
          ></left-bar-detail>
          <right-bar :height="leftHeight"></right-bar>
          <div
            id="content"
            class="content"
            style="height: 90%; background-color: #fafafa"
            ref="content"
          >
            <!-- 배경담는 div -->
            <div id="img-background"></div>
            <!-- cnavas에 직접 drsElement와 drsMoveHandle을 주면 크기조절이 불가능해서 div로 감싸줘서 이걸 움직이도록 -->
            <div
              v-on:mouseover.left="changeSize"
              id="canvasBox"
              class="drsElement drsMoveHandle"
              :style="{'left': initCanvasLeft+'px', 'top': initCanvasTop+'px', 'width': '550px', 'height': '550px', 'border-style': '10px solid red', 'background-color':'rgba(255,255,255,0)'}"
            >
              <canvas
                id="myCanvas"
                style="
                  width: 100%;
                  height: 100%;
                  background-color: rgba(255, 255, 255, 0);
                "
              >
              </canvas>
            </div>
          </div>
          <v-spacer></v-spacer>
          <loading-bar @pointer="setPointer"></loading-bar>
          <snapshot
            v-show="activeSnapShot"
            :pointx="pointx"
            :pointy="pointy"
          ></snapshot>
        </v-main>
      </v-app>
    </div>

    <script src="main.js"></script>
    <script src="gif.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
    <script src="https://unpkg.com/http-vue-loader"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.5.1/vuex.min.js"></script>

    <script>
      Vue.use(httpVueLoader);
      Vue.use(Vuex);
      var EventBus = new Vue();

      // Drag and Resize
      var dragresize = new DragResize('dragresize', {
        minWidth: 10,
        minHeight: 10,
        minLeft: 64,
        minTop: 0,
        maxLeft: 1912,
        maxTop: 830,
      });
      dragresize.isElement = function (elm) {
        if (elm.className && elm.className.indexOf('drsElement') > -1)
          return true;
      };
      dragresize.isHandle = function (elm) {
        if (elm.className && elm.className.indexOf('drsMoveHandle') > -1)
          return true;
      };
      dragresize.apply(document);

      // Import store
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'store/index.js';
      document.head.appendChild(script);

      script.onload = (_) => {
        new Vue({
          el: '#app',
          vuetify: new Vuetify(),
          store,
          components: {
            'loading-bar': 'url:./components/loading-bar.vue',
            'left-bar': 'url:./components/left-bar.vue',
            'left-bar-detail': 'url:./components/left-bar-detail.vue',
            'right-bar': 'url:./components/right-bar.vue',
            snapshot: 'url:./components/snapshot.vue',
            'upper-bar': 'url:./components/upper-bar.vue',
          },
          computed: {
            ...Vuex.mapGetters(['getLayers']),
          },
          data() {
            return {
              activeDetailBar: true,
              selectedMenu: 1,
              leftHeight: 0,
              canvasSize: {
                height: 550,
                width: 550,
              },
              initialPosition: (window.innerWidth - 550) / 2,
              initCanvasTop: 0,
              initCanvasLeft: 0,
              pointx: 0,
              pointy: 0,
              activeSnapShot: false,
            };
          },
          methods: {
            ChangeMenu(i) {
              if (this.selectedMenu == i) {
                this.activeDetailBar = false;
                this.selectedMenu = 0;
              } else {
                this.activeDetailBar = true;
                this.selectedMenu = i;
              }
            },
            CloseMenuBar() {
              this.activeDetailBar = false;
              this.selectedMenu = 0;
            },
            setHeight(val) {
              this.leftHeight = val - 104;
            },
            changeSize() {
              this.canvasSize.height = Number(
                document.getElementById('canvasBox').style.height.slice(0, -2),
              );
              this.canvasSize.width = Number(
                document.getElementById('canvasBox').style.width.slice(0, -2),
              );
            },
            setPointer(pointer) {
              this.pointx = pointer.x - 75;
              this.pointy = pointer.y - 180;
              this.activeSnapShot = pointer.isSnapShot;
            },
          },
          mounted() {
            this.initCanvasLeft = (this.$refs.content.clientWidth - 550) / 2;
            this.initCanvasTop = (this.$refs.content.clientHeight - 550) / 2;
            EventBus.$on('initLayers', ({ layers }) => {
              store.commit('setLayers', layers);
            });
          },
        });
      };
    </script>
  </body>
  <style>
    .main-window {
      width: 100%;
      height: 100%;
      background-color: #171719;
    }
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
      border: 3px solid #fff;
    }
    ::-webkit-scrollbar-button:start:decrement,
    ::-webkit-scrollbar-button:end:increment {
      display: block;
      height: 10px;
      background: #efefef;
    }
    ::-webkit-scrollbar-track {
      background: #efefef;
      -webkit-border-radius: 10px;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      height: 50px;
      width: 50px;
      background: rgb(41, 44, 49, 0.3);
      -webkit-border-radius: 8px;
      border-radius: 8px;
    }
    #app {
      overflow: hidden;
    }
  </style>
</html>
